# Google Analytics å’Œ Cookie åŒæ„ - å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ 5 åˆ†é’Ÿå†…å¿«é€Ÿé…ç½®å’Œä½¿ç”¨ Google Analytics 4 (GA4) å’Œ Cookie åŒæ„åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿé…ç½®ï¼ˆ5 åˆ†é’Ÿï¼‰

### æ­¥éª¤ 1: è·å– Google Analytics ID

1. è®¿é—® [Google Analytics](https://analytics.google.com/)
2. åˆ›å»ºæ–°çš„ GA4 å±æ€§
3. è·å–æµ‹é‡ IDï¼ˆæ ¼å¼ï¼š`G-XXXXXXXXXX`ï¼‰

### æ­¥éª¤ 2: é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# Google Analytics é…ç½®
NUXT_PUBLIC_GOOGLE_ANALYTICS_ID=G-XXXXXXXXXX

# ç½‘ç«™åŸºæœ¬ä¿¡æ¯
NUXT_PUBLIC_SITE_URL=https://your-domain.com
NUXT_PUBLIC_SITE_NAME=æ‚¨çš„ç½‘ç«™åç§°
```

### æ­¥éª¤ 3: å¯åŠ¨é¡¹ç›®

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### æ­¥éª¤ 4: éªŒè¯åŠŸèƒ½

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`
2. æ‚¨åº”è¯¥çœ‹åˆ° Cookie åŒæ„æ¨ªå¹…
3. ç‚¹å‡»"æ¥å—æ‰€æœ‰"å¯ç”¨åˆ†æåŠŸèƒ½
4. è®¿é—® `/analytics-usage-example` é¡µé¢æµ‹è¯•å„ç§åŠŸèƒ½

## ğŸ“‹ åŸºç¡€ä½¿ç”¨

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨åˆ†æåŠŸèƒ½

```vue
<template>
  <div>
    <!-- è·Ÿè¸ªæŒ‰é’®ç‚¹å‡» -->
    <button @click="handleClick">
      ç‚¹å‡»æˆ‘
    </button>
  </div>
</template>

<script setup>
// å¯¼å…¥åˆ†æåŠŸèƒ½
const { trackButtonClick, isAnalyticsEnabled } = useAnalytics()

// å¤„ç†æŒ‰é’®ç‚¹å‡»
const handleClick = () => {
  trackButtonClick('my_button', 'header')
}

// æ£€æŸ¥åˆ†æçŠ¶æ€
console.log('åˆ†æå·²å¯ç”¨:', isAnalyticsEnabled.value)
</script>
```

### å¸¸ç”¨äº‹ä»¶è·Ÿè¸ª

```javascript
// 1. æŒ‰é’®ç‚¹å‡»
trackButtonClick('signup_button', 'header')

// 2. è¡¨å•æäº¤
trackFormSubmit('contact_form', true) // true = æˆåŠŸ

// 3. æœç´¢
trackSearch('äº§å“åç§°', 15) // æœç´¢è¯, ç»“æœæ•°é‡

// 4. æ–‡ä»¶ä¸‹è½½
trackDownload('user-guide.pdf', 'pdf')

// 5. å¤–éƒ¨é“¾æ¥
trackExternalLink('https://example.com', 'åˆä½œä¼™ä¼´')

// 6. è‡ªå®šä¹‰äº‹ä»¶
trackEvent({
  name: 'custom_action',
  category: 'engagement',
  label: 'user_interaction'
})
```

## ğŸª Cookie ç®¡ç†

### æ£€æŸ¥ Cookie çŠ¶æ€

```javascript
const { getCookiePreferences, isAnalyticsEnabled } = useAnalytics()

// è·å–å½“å‰åå¥½
const preferences = getCookiePreferences()
console.log(preferences)
// { necessary: true, analytics: false, marketing: false }

// æ£€æŸ¥åˆ†ææ˜¯å¦å¯ç”¨
if (isAnalyticsEnabled.value) {
  // æ‰§è¡Œåˆ†æç›¸å…³æ“ä½œ
}
```

### æ›´æ–° Cookie åå¥½

```javascript
const { saveCookiePreferences } = useAnalytics()

// æ›´æ–°åå¥½
saveCookiePreferences({
  necessary: true,
  analytics: true,
  marketing: false
})
```

## ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹

### ç”µå•†ç½‘ç«™ç¤ºä¾‹

```vue
<template>
  <div>
    <!-- äº§å“é¡µé¢ -->
    <div class="product">
      <h1>{{ product.name }}</h1>
      <button @click="addToCart">åŠ å…¥è´­ç‰©è½¦</button>
      <button @click="buyNow">ç«‹å³è´­ä¹°</button>
    </div>
  </div>
</template>

<script setup>
const { trackButtonClick, trackEvent, setUserProperties } = useAnalytics()

const product = ref({
  id: 'prod_123',
  name: 'ç¤ºä¾‹äº§å“',
  price: 99.99,
  category: 'ç”µå­äº§å“'
})

// åŠ å…¥è´­ç‰©è½¦
const addToCart = () => {
  trackButtonClick('add_to_cart', 'product_page')
  
  // è·Ÿè¸ªç”µå•†äº‹ä»¶
  trackEvent({
    name: 'add_to_cart',
    category: 'ecommerce',
    value: product.value.price,
    currency: 'CNY',
    item_id: product.value.id,
    item_name: product.value.name,
    item_category: product.value.category
  })
}

// ç«‹å³è´­ä¹°
const buyNow = () => {
  trackButtonClick('buy_now', 'product_page')
  
  // è®¾ç½®ç”¨æˆ·å±æ€§
  setUserProperties({
    last_product_viewed: product.value.id,
    product_category_interest: product.value.category
  })
}

// é¡µé¢åŠ è½½æ—¶è·Ÿè¸ªäº§å“æµè§ˆ
onMounted(() => {
  trackEvent({
    name: 'view_item',
    category: 'ecommerce',
    item_id: product.value.id,
    item_name: product.value.name,
    item_category: product.value.category,
    value: product.value.price,
    currency: 'CNY'
  })
})
</script>
```

### åšå®¢ç½‘ç«™ç¤ºä¾‹

```vue
<template>
  <div>
    <!-- æ–‡ç« é¡µé¢ -->
    <article>
      <h1>{{ article.title }}</h1>
      <div class="article-content" @scroll="trackReadProgress">
        {{ article.content }}
      </div>
      <button @click="shareArticle">åˆ†äº«æ–‡ç« </button>
    </article>
  </div>
</template>

<script setup>
const { trackEvent, trackButtonClick, setUserProperties } = useAnalytics()

const article = ref({
  id: 'article_123',
  title: 'ç¤ºä¾‹æ–‡ç« ',
  category: 'æŠ€æœ¯',
  author: 'ä½œè€…å',
  readTime: 5
})

let readProgress = 0

// è·Ÿè¸ªé˜…è¯»è¿›åº¦
const trackReadProgress = (event) => {
  const element = event.target
  const scrollPercent = Math.round(
    (element.scrollTop / (element.scrollHeight - element.clientHeight)) * 100
  )
  
  // æ¯ 25% è·Ÿè¸ªä¸€æ¬¡
  if (scrollPercent >= readProgress + 25) {
    readProgress = scrollPercent
    trackEvent({
      name: 'scroll_progress',
      category: 'engagement',
      label: `${scrollPercent}%`,
      value: scrollPercent,
      article_id: article.value.id
    })
  }
}

// åˆ†äº«æ–‡ç« 
const shareArticle = () => {
  trackButtonClick('share_article', 'article_page')
  
  trackEvent({
    name: 'share',
    category: 'engagement',
    method: 'button',
    content_type: 'article',
    content_id: article.value.id
  })
}

// é¡µé¢åŠ è½½æ—¶è®¾ç½®ç”¨æˆ·å±æ€§
onMounted(() => {
  setUserProperties({
    content_category_interest: article.value.category,
    last_article_read: article.value.id,
    estimated_read_time: article.value.readTime
  })
  
  // è·Ÿè¸ªæ–‡ç« æµè§ˆ
  trackEvent({
    name: 'page_view',
    category: 'content',
    page_title: article.value.title,
    content_category: article.value.category,
    author: article.value.author
  })
})
</script>
```

## ğŸ”§ è°ƒè¯•å’Œæµ‹è¯•

### å¼€å‘ç¯å¢ƒè°ƒè¯•

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ£€æŸ¥
console.log('GA æ•°æ®å±‚:', window.dataLayer)
console.log('Cookie åå¥½:', getCookiePreferences())
console.log('åˆ†æçŠ¶æ€:', isAnalyticsEnabled.value)

// å¯ç”¨ GA è°ƒè¯•æ¨¡å¼ï¼ˆåœ¨ gtag.client.ts ä¸­ï¼‰
if (process.dev) {
  window.gtag('config', 'G-XXXXXXXXXX', {
    debug_mode: true
  })
}
```

### éªŒè¯äº‹ä»¶å‘é€

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘å·¥å…·
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. è¿‡æ»¤ `google-analytics.com` æˆ– `analytics.google.com`
4. æ‰§è¡Œæ“ä½œï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è¯·æ±‚å‘é€

### GA4 å®æ—¶æŠ¥å‘Š

1. è®¿é—® [Google Analytics](https://analytics.google.com/)
2. é€‰æ‹©æ‚¨çš„å±æ€§
3. æŸ¥çœ‹"å®æ—¶"æŠ¥å‘Š
4. éªŒè¯äº‹ä»¶æ˜¯å¦æ­£ç¡®æ˜¾ç¤º

## ğŸ“š æ›´å¤šèµ„æº

- [å®Œæ•´é…ç½®æŒ‡å—](./Google-Analytics-Cookie-é…ç½®æŒ‡å—.md)
- [ä»£ç ç¤ºä¾‹](../examples/analytics-code-examples.js)
- [ä½¿ç”¨ç¤ºä¾‹é¡µé¢](/analytics-usage-example)
- [éšç§æ”¿ç­–é¡µé¢](/privacy)

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆçœ‹ä¸åˆ° Cookie æ¨ªå¹…ï¼Ÿ
A: æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦å·²æœ‰åŒæ„è®°å½•ï¼Œæ¸…é™¤æµè§ˆå™¨æ•°æ®åé‡è¯•ã€‚

### Q: äº‹ä»¶æ²¡æœ‰å‘é€åˆ° GAï¼Ÿ
A: ç¡®è®¤åˆ†æ Cookie å·²å¯ç”¨ï¼Œæ£€æŸ¥æµ‹é‡ ID æ˜¯å¦æ­£ç¡®ã€‚

### Q: å¦‚ä½•æµ‹è¯•ä¸åŒçš„ Cookie è®¾ç½®ï¼Ÿ
A: ä½¿ç”¨æµè§ˆå™¨çš„éšç§æ¨¡å¼æˆ–æ¸…é™¤æœ¬åœ°å­˜å‚¨æ•°æ®ã€‚

### Q: å¯ä»¥è‡ªå®šä¹‰ Cookie æ¨ªå¹…æ ·å¼å—ï¼Ÿ
A: å¯ä»¥ï¼Œç¼–è¾‘ `components/CookieConsent.vue` æ–‡ä»¶ä¸­çš„æ ·å¼ã€‚

### Q: å¦‚ä½•æ·»åŠ æ›´å¤š Cookie ç±»å‹ï¼Ÿ
A: ä¿®æ”¹ `composables/useAnalytics.ts` ä¸­çš„ `CookiePreferences` æ¥å£å’Œç›¸å…³é€»è¾‘ã€‚

---

ğŸ‰ æ­å–œï¼æ‚¨å·²ç»æˆåŠŸé…ç½®äº† Google Analytics å’Œ Cookie åŒæ„åŠŸèƒ½ã€‚å¼€å§‹è·Ÿè¸ªç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–æ‚¨çš„ç½‘ç«™ä½“éªŒå§ï¼