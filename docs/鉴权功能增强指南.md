# OAuth å¤šå¹³å°ç™»å½•é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•åœ¨ Nuxt 3 æ¨¡æ¿é¡¹ç›®ä¸­é…ç½®å¤šä¸ª OAuth æä¾›å•†ï¼Œæ”¯æŒ Googleã€GitHubã€Discordã€Twitterã€Microsoft å’Œ Facebook ç™»å½•ã€‚

## ğŸš€ æ”¯æŒçš„ OAuth æä¾›å•†

- **Google** - æœ€å¸¸ç”¨çš„ç™»å½•æ–¹å¼
- **GitHub** - å¼€å‘è€…å‹å¥½çš„ç™»å½•é€‰é¡¹
- **Discord** - æ¸¸æˆå’Œç¤¾åŒºåº”ç”¨çš„çƒ­é—¨é€‰æ‹©
- **Twitter** - ç¤¾äº¤åª’ä½“ç™»å½•
- **Microsoft** - ä¼ä¸šå’Œæ•™è‚²ç”¨æˆ·
- **Facebook** - ç¤¾äº¤ç½‘ç»œç™»å½•

## ğŸ“‹ é…ç½®æ­¥éª¤

### 1. ç¯å¢ƒå˜é‡é…ç½®

å¤åˆ¶ `.env.example` æ–‡ä»¶ä¸º `.env`ï¼Œå¹¶æ ¹æ®éœ€è¦é…ç½®ç›¸åº”çš„ OAuth æä¾›å•†ï¼š

```bash
cp .env.example .env
```

### 2. Google OAuth é…ç½®

1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. åˆ›å»ºæ–°é¡¹ç›®æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®
3. å¯ç”¨ Google+ API
4. åˆ›å»º OAuth 2.0 å®¢æˆ·ç«¯ ID
5. è®¾ç½®æˆæƒé‡å®šå‘ URIï¼š`http://localhost:3000/api/auth/callback/google`

```env
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

### 3. GitHub OAuth é…ç½®

1. è®¿é—® [GitHub Settings > Developer settings > OAuth Apps](https://github.com/settings/applications/new)
2. åˆ›å»ºæ–°çš„ OAuth åº”ç”¨
3. è®¾ç½® Authorization callback URLï¼š`http://localhost:3000/api/auth/callback/github`

```env
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
```

### 4. Discord OAuth é…ç½®

1. è®¿é—® [Discord Developer Portal](https://discord.com/developers/applications)
2. åˆ›å»ºæ–°åº”ç”¨
3. åœ¨ OAuth2 è®¾ç½®ä¸­æ·»åŠ é‡å®šå‘ URLï¼š`http://localhost:3000/api/auth/callback/discord`

```env
DISCORD_CLIENT_ID=your-discord-client-id
DISCORD_CLIENT_SECRET=your-discord-client-secret
```

### 5. Twitter OAuth é…ç½®

1. è®¿é—® [Twitter Developer Portal](https://developer.twitter.com/en/portal/dashboard)
2. åˆ›å»ºæ–°åº”ç”¨
3. å¯ç”¨ OAuth 2.0
4. è®¾ç½®å›è°ƒ URLï¼š`http://localhost:3000/api/auth/callback/twitter`

```env
TWITTER_CLIENT_ID=your-twitter-client-id
TWITTER_CLIENT_SECRET=your-twitter-client-secret
```

### 6. Microsoft OAuth é…ç½®

1. è®¿é—® [Azure Portal](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)
2. åˆ›å»ºæ–°çš„åº”ç”¨æ³¨å†Œ
3. è®¾ç½®é‡å®šå‘ URIï¼š`http://localhost:3000/api/auth/callback/microsoft`

```env
MICROSOFT_CLIENT_ID=your-microsoft-client-id
MICROSOFT_CLIENT_SECRET=your-microsoft-client-secret
MICROSOFT_TENANT_ID=your-microsoft-tenant-id
```

### 7. Facebook OAuth é…ç½®

1. è®¿é—® [Facebook Developers](https://developers.facebook.com/apps/)
2. åˆ›å»ºæ–°åº”ç”¨
3. æ·»åŠ  Facebook Login äº§å“
4. è®¾ç½®æœ‰æ•ˆçš„ OAuth é‡å®šå‘ URIï¼š`http://localhost:3000/api/auth/callback/facebook`

```env
FACEBOOK_CLIENT_ID=your-facebook-client-id
FACEBOOK_CLIENT_SECRET=your-facebook-client-secret
```

## ğŸ”§ æŠ€æœ¯å®ç°

### åŠ¨æ€æä¾›å•†è¿‡æ»¤

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å·²é…ç½®çš„ OAuth æä¾›å•†ï¼Œåªæ˜¾ç¤ºå·²é…ç½®çš„ç™»å½•é€‰é¡¹ï¼š

```typescript
// åªåŒ…å«å·²é…ç½®çš„æä¾›å•†
].filter(provider => {
  const providerName = provider.id;
  const clientIdKey = `${providerName}ClientId`;
  const clientSecretKey = `${providerName}ClientSecret`;
  
  return runtimeConfig[clientIdKey] && runtimeConfig[clientSecretKey];
})
```

### ç®€åŒ–çš„å›è°ƒå¤„ç†

```typescript
callbacks: {
  async jwt({ token, account, user }) {
    if (account && user) {
      token.accessToken = account.access_token;
      token.provider = account.provider;
      token.userId = user.id;
    }
    return token;
  },
  
  async session({ session, token }) {
    if (token && session.user) {
      session.accessToken = token.accessToken;
      session.provider = token.provider;
      session.user.id = token.userId;
    }
    return session;
  }
}
```

## ğŸ¨ ç™»å½•ç•Œé¢

ç™»å½•é¡µé¢ä¼šæ ¹æ®é…ç½®çš„æä¾›å•†è‡ªåŠ¨æ˜¾ç¤ºç›¸åº”çš„ç™»å½•æŒ‰é’®ï¼Œæ¯ä¸ªæŒ‰é’®éƒ½æœ‰ç‹¬ç‰¹çš„å“ç‰Œé¢œè‰²å’Œå›¾æ ‡ï¼š

- **Google**: çº¢è‰²èƒŒæ™¯ï¼ŒGoogle å›¾æ ‡
- **GitHub**: æ·±ç°è‰²èƒŒæ™¯ï¼ŒGitHub å›¾æ ‡
- **Discord**: é›è“è‰²èƒŒæ™¯ï¼ŒDiscord å›¾æ ‡
- **Twitter**: è“è‰²èƒŒæ™¯ï¼ŒTwitter å›¾æ ‡
- **Microsoft**: è“è‰²èƒŒæ™¯ï¼ŒMicrosoft å›¾æ ‡
- **Facebook**: æ·±è“è‰²èƒŒæ™¯ï¼ŒFacebook å›¾æ ‡

## ğŸ”’ å®‰å…¨é…ç½®

### ç”Ÿäº§ç¯å¢ƒé…ç½®

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·ç¡®ä¿ï¼š

1. ä½¿ç”¨å¼ºå¯†ç ä½œä¸º `NUXT_AUTH_SECRET`
2. æ­£ç¡®è®¾ç½®å›è°ƒ URL ä¸ºç”Ÿäº§åŸŸå
3. é™åˆ¶ OAuth åº”ç”¨çš„è®¿é—®æƒé™
4. å®šæœŸè½®æ¢å®¢æˆ·ç«¯å¯†é’¥

### å›è°ƒ URL æ¨¡å¼

æ‰€æœ‰ OAuth æä¾›å•†çš„å›è°ƒ URL éµå¾ªç›¸åŒæ¨¡å¼ï¼š
```
{DOMAIN}/api/auth/callback/{PROVIDER}
```

ä¾‹å¦‚ï¼š
- æœ¬åœ°å¼€å‘ï¼š`http://localhost:3000/api/auth/callback/google`
- ç”Ÿäº§ç¯å¢ƒï¼š`https://yourdomain.com/api/auth/callback/google`

## ğŸ“± ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ç™»å½•

```vue
<script setup>
const { signIn, signOut, data: session } = useAuth();

// ç™»å½•
const handleLogin = (provider) => {
  signIn(provider);
};

// ç™»å‡º
const handleLogout = () => {
  signOut();
};
</script>
```

### è·å–ç”¨æˆ·ä¿¡æ¯

```vue
<template>
  <div v-if="session">
    <p>æ¬¢è¿ï¼Œ{{ session.user?.name }}ï¼</p>
    <p>é‚®ç®±ï¼š{{ session.user?.email }}</p>
    <p>ç™»å½•æ–¹å¼ï¼š{{ session.provider }}</p>
  </div>
</template>
```

## ğŸš€ éƒ¨ç½²æ³¨æ„äº‹é¡¹

1. **æ›´æ–°å›è°ƒ URL**ï¼šå°†æ‰€æœ‰ OAuth åº”ç”¨çš„å›è°ƒ URL æ›´æ–°ä¸ºç”Ÿäº§åŸŸå
2. **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ç”Ÿäº§ç¯å¢ƒä¸­è®¾ç½®äº†æ‰€æœ‰å¿…è¦çš„ç¯å¢ƒå˜é‡
3. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
4. **åŸŸåéªŒè¯**ï¼šæŸäº›æä¾›å•†éœ€è¦éªŒè¯åŸŸåæ‰€æœ‰æƒ

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å›è°ƒ URL ä¸åŒ¹é…**
   - æ£€æŸ¥ OAuth åº”ç”¨é…ç½®ä¸­çš„å›è°ƒ URL
   - ç¡®ä¿ URL å®Œå…¨åŒ¹é…ï¼ˆåŒ…æ‹¬åè®®å’Œç«¯å£ï¼‰

2. **å®¢æˆ·ç«¯å¯†é’¥é”™è¯¯**
   - éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
   - æ£€æŸ¥æ˜¯å¦æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–æ¢è¡Œç¬¦

3. **æƒé™ä¸è¶³**
   - ç¡®ä¿ OAuth åº”ç”¨æœ‰è¶³å¤Ÿçš„æƒé™
   - æ£€æŸ¥ API æ˜¯å¦å·²å¯ç”¨

### è°ƒè¯•æ¨¡å¼

å¼€å‘ç¯å¢ƒä¸­å¯ç”¨äº†è°ƒè¯•æ¨¡å¼ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†çš„ç™»å½•æ—¥å¿—ï¼š

```typescript
debug: process.env.NODE_ENV === "development"
```

## ğŸ“š ç›¸å…³èµ„æº

- [NextAuth.js å®˜æ–¹æ–‡æ¡£](https://next-auth.js.org/)
- [Nuxt Auth æ–‡æ¡£](https://sidebase.io/nuxt-auth/)
- [OAuth 2.0 è§„èŒƒ](https://oauth.net/2/)

## ğŸ”„ æ›´æ–°æ—¥å¿—

- **ç®€åŒ–é…ç½®**ï¼šç§»é™¤äº†å¤æ‚çš„è§’è‰²æƒé™ç³»ç»Ÿ
- **å¤šå¹³å°æ”¯æŒ**ï¼šæ–°å¢ Discordã€Twitterã€Microsoftã€Facebook ç™»å½•
- **åŠ¨æ€è¿‡æ»¤**ï¼šåªæ˜¾ç¤ºå·²é…ç½®çš„ç™»å½•é€‰é¡¹
- **ä¼˜åŒ–ç•Œé¢**ï¼šæ”¹è¿›ç™»å½•é¡µé¢çš„ç”¨æˆ·ä½“éªŒ